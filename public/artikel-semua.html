<!doctype html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Semua Artikel | OSIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/styles.css" />
    <!-- Animate On Scroll Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  </head>
  <body>
    <header class="site-header">
      <div class="container nav">
        <div class="brand">
          <div id="site-logo" class="logo"><img src="/uploads/logo.png" alt="Logo OSIS" style="height: 24px; width: auto; display: block;"></div>
          <span class="divider"></span>
          <span id="site-name" class="school">OSIS SMA NEGERI 1 BABAT</span>
        </div>
        <nav class="menu">
          <a href="/#beranda">Beranda</a>
          <a href="/#osis">Profil OSIS</a>
          <a href="/artikel-semua.html">Artikel</a>
          <a href="/#agenda">Agenda Kegiatan</a>
          <a href="/struktur.html">Struktur</a>
          <a href="/gallery.html">Galeri</a>
          <a href="/#saran">Saran/Laporan</a>
        </nav>
      </div>
    </header>

    <div class="page-wrapper">
      <main class="section">
        <div class="container">
          <h2 class="section-title" data-aos="fade-up">Semua Artikel</h2>
          <ul id="all-articles-grid" class="grid" style="list-style: none; padding: 0;">
              <!-- Artikel akan dimuat di sini -->
              <p class="hint">Memuat semua artikel...</p>
          </ul>
          <div id="pagination-controls" class="pagination"></div>
        </div>
      </main>

      <footer class="site-footer">
        <div class="container">
          <p id="footer-text">Memuat footer...</p>
        </div>
      </footer>
    </div>

    <button id="to-top-btn" class="to-top-btn" title="Kembali ke atas">↑</button>

    <script src="/shared.js" defer></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        // State untuk paginasi
        let allArticles = [];
        let currentPage = 1;
        const itemsPerPage = 8;

        function renderArticlesPage(page) {
          currentPage = page;
          const grid = document.getElementById('all-articles-grid');
          const paginationControls = document.getElementById('pagination-controls');
          grid.innerHTML = '';
          paginationControls.innerHTML = '';

          const startIndex = (currentPage - 1) * itemsPerPage;
          const endIndex = startIndex + itemsPerPage;
          const paginatedItems = allArticles.slice(startIndex, endIndex);

          paginatedItems.forEach((a, index) => {
            const li = document.createElement('li');
            li.className = 'card post-item';
            li.setAttribute('data-aos', 'fade-up');
            li.setAttribute('data-aos-delay', 50 * (index + 1)); // Efek bertingkat
            const snippet = a.content.length > 100 ? a.content.substring(0, 100) + '...' : a.content;
            const thumbnailHtml = a.thumbnailUrl
              ? `<img src="${a.thumbnailUrl}" alt="Thumbnail ${a.title}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px; margin-bottom: 12px;">`
              : '';

            li.innerHTML = `
              <a href="/artikel.html?id=${a.id}" style="text-decoration: none; color: inherit; display: block;">
                ${thumbnailHtml}
                <h4 class="post-title">${a.title}</h4>
                <div class="post-meta">${a.author} • ${formatDate(a.createdAt)}</div>
                <div style="opacity: 0.8;">${snippet}</div>
              </a>
            `;
            grid.appendChild(li);
          });

          // Render tombol paginasi
          const totalPages = Math.ceil(allArticles.length / itemsPerPage);
          for (let i = 1; i <= totalPages; i++) {
            const button = document.createElement('button');
            button.textContent = i;
            if (i === currentPage) button.classList.add('active');
            button.addEventListener('click', () => renderArticlesPage(i));
            paginationControls.appendChild(button);
          }

          // Refresh AOS untuk mendeteksi elemen baru
          setTimeout(() => AOS.refresh(), 50);
        }

        const formatDate = (isoString) => {
            try {
                const d = new Date(isoString);
                return new Intl.DateTimeFormat('id-ID', {
                dateStyle: 'medium',
                timeStyle: 'short'
                }).format(d);
            } catch {
                return isoString;
            }
        };

        async function loadAllArticles() {
            const res = await fetch('/api/articles');
            allArticles = await res.json();
            renderArticlesPage(1); // Tampilkan halaman pertama
        }

        document.addEventListener('DOMContentLoaded', () => {
            AOS.init({
                duration: 800,
                once: true,
            });
            loadAllArticles();

            // Logika untuk tombol "Kembali ke Atas"
            const toTopBtn = document.getElementById('to-top-btn');
            if (toTopBtn) {
                window.addEventListener('scroll', () => {
                    if (window.scrollY > 300) {
                        toTopBtn.classList.add('show');
                    } else {
                        toTopBtn.classList.remove('show');
                    }
                });
                toTopBtn.addEventListener('click', () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }
        });
    </script>
  </body>
</html>